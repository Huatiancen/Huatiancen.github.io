---
layout: default
---

<div class="archive-container fade-in-up">
  <header class="archive-header">
    <h1 class="archive-title">{{ page.title }}</h1>
    <p class="archive-subtitle">
      {% if page.type == 'categories' %}
        æŒ‰åˆ†ç±»æµè§ˆæ‰€æœ‰æ–‡ç« 
      {% elsif page.type == 'tags' %}
        æŒ‰æ ‡ç­¾æµè§ˆæ‰€æœ‰æ–‡ç« 
      {% else %}
        æµè§ˆæ‰€æœ‰æ–‡ç« åˆ†ç±»
      {% endif %}
    </p>
  </header>

  <!-- æœç´¢åŠŸèƒ½ -->
  <div class="search-container">
    <input type="text" id="tag-search" class="search-input" 
           placeholder="ğŸ” æœç´¢{% if page.type == 'categories' %}åˆ†ç±»{% else %}æ ‡ç­¾{% endif %}..." autocomplete="off">
    <div class="search-stats">
      <span id="search-stats"></span>
    </div>
  </div>

  {% comment %} Check the type of archive {% endcomment %}
  {%- if page.type == 'categories' -%}
    {%- assign taxonomies = site.categories -%}
  {%- elsif page.type == 'tags' -%}
    {%- assign taxonomies = site.tags -%}
  {%- else -%}
    {%- assign taxonomies = none -%}
  {%- endif -%}

  {% comment %} Calculate the max count of taxonomies {% endcomment %}
  {%- assign max_count = 0 -%}
  {%- for taxonomy in taxonomies -%}
    {%- assign posts = taxonomy[1] -%}
    {%- if posts.size > max_count -%}
      {%- assign max_count = posts.size -%}
    {%- endif -%}
  {%- endfor -%}

  <div class="taxonomies-wrapper">
    <div class="taxonomies-cloud" id="taxonomies-list">
      {%- for i in (1..max_count) reversed -%}
        {%- for taxonomy in taxonomies -%}
          {%- assign taxonomy_name = taxonomy[0] -%}
          {%- assign slugified_taxonomy_name = taxonomy_name | slugify -%}
          {%- assign posts = taxonomy[1] -%}
          {%- if posts.size == i -%}
            <div class="taxonomy-tag-card" data-tag="{{ slugified_taxonomy_name | downcase }}">
              {%- capture link -%}{{ page.permalink }}#{{ slugified_taxonomy_name }}{%- endcapture -%}
              <a class="taxonomy-tag-link" href="{{ link | relative_url }}">
                <div class="tag-icon">
                  {% if page.type == 'categories' %}ğŸ—‚ï¸{% else %}ğŸ·ï¸{% endif %}
                </div>
                <div class="tag-content">
                  <span class="tag-name">
                    {%- if page.type == 'tags' -%}
                      {{ slugified_taxonomy_name }}
                    {%- else -%}
                      {{ taxonomy_name }}
                    {%- endif -%}
                  </span>
                  <span class="tag-count">{{ posts.size }} ç¯‡æ–‡ç« </span>
                </div>
              </a>
            </div>
          {%- endif -%}
        {%- endfor -%}
      {%- endfor -%}
    </div>
  </div>

  {% comment %} Show posts by taxonomy {% endcomment %}
  {%- for i in (1..max_count) reversed -%}
    {%- for taxonomy in taxonomies -%}
      {%- assign taxonomy_name = taxonomy[0] -%}
      {%- assign slugified_taxonomy_name = taxonomy_name | slugify -%}
      {%- assign posts = taxonomy[1] -%}
      {%- if posts.size == i -%}
        <section class="archive-section" id="{{ slugified_taxonomy_name }}" data-tag="{{ slugified_taxonomy_name | downcase }}">
          <header class="archive-section-header">
            <h2 class="archive-group-title">
              {%- if page.type == 'tags' -%}
                æ ‡ç­¾ï¼š{{ slugified_taxonomy_name }}
              {%- else -%}
                åˆ†ç±»ï¼š{{ taxonomy_name }}
              {%- endif -%}
            </h2>
            <div class="post-search-container">
              <input type="text" class="post-search search-input" 
                     placeholder="ğŸ” æœç´¢è¯¥{% if page.type == 'categories' %}åˆ†ç±»{% else %}æ ‡ç­¾{% endif %}ä¸‹çš„æ–‡ç« ..." 
                     data-tag="{{ slugified_taxonomy_name | downcase }}">
              <span class="post-search-stats"></span>
            </div>
          </header>
          
          <div class="archive-posts-grid" data-tag="{{ slugified_taxonomy_name | downcase }}">
            {%- for post in posts -%}
              <article class="archive-item" data-title="{{ post.title | downcase }}" data-date="{{ post.date | date: '%Y-%m-%d' }}">
                <div class="archive-item-content">
                  <h3 class="archive-item-title">
                    <a href="{{ post.url | relative_url }}">{{ post.title | escape }}</a>
                  </h3>
                  <div class="archive-item-meta">
                    <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%Yå¹´%mæœˆ%dæ—¥" }}</time>
                    {% if post.tags and page.type != 'tags' %}
                      <div class="archive-item-tags">
                        {% for tag in post.tags limit:3 %}
                          <span class="tag">{{ tag }}</span>
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>
                  {% if post.excerpt %}
                    <p class="archive-item-excerpt">{{ post.excerpt | strip_html | truncate: 100 }}</p>
                  {% endif %}
                </div>
              </article>
            {%- endfor -%}
          </div>
          
          <div class="no-results" style="display: none;">
            <div class="no-results-content">
              <div class="no-results-icon">ï¿½</div>
              <p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ç« </p>
            </div>
          </div>
          
          <div class="back-to-top-container">
            <button onclick="backToTop()" class="btn btn-secondary back-to-top">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
              </svg>
              å›åˆ°é¡¶éƒ¨
            </button>
          </div>
        </section>
      {%- endif -%}
    {%- endfor -%}
  {%- endfor -%}
</div>

<script>
  function backToTop() {
    const main = document.getElementById("site-main");
    main.scrollTop = 0;
  }

  // æ ‡ç­¾æœç´¢åŠŸèƒ½
  document.addEventListener('DOMContentLoaded', function() {
    const tagSearchInput = document.getElementById('tag-search');
    const searchStats = document.getElementById('search-stats');
    const taxonomyItems = document.querySelectorAll('.taxonomy-item');
    
    if (tagSearchInput) {
      tagSearchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        let visibleCount = 0;
        let totalCount = taxonomyItems.length;
        
        taxonomyItems.forEach(function(item) {
          const tagName = item.getAttribute('data-tag');
          const isVisible = tagName.includes(searchTerm);
          
          if (isVisible) {
            item.classList.remove('hidden');
            visibleCount++;
          } else {
            item.classList.add('hidden');
          }
        });
        
        // æ›´æ–°æœç´¢ç»Ÿè®¡
        if (searchTerm === '') {
          searchStats.textContent = `å…± ${totalCount} ä¸ªæ ‡ç­¾`;
        } else {
          searchStats.textContent = `æ‰¾åˆ° ${visibleCount} / ${totalCount} ä¸ªæ ‡ç­¾`;
        }
      });
      
      // åˆå§‹åŒ–ç»Ÿè®¡
      searchStats.textContent = `å…± ${taxonomyItems.length} ä¸ªæ ‡ç­¾`;
    }
    
    // æ–‡ç« æœç´¢åŠŸèƒ½
    const postSearchInputs = document.querySelectorAll('.post-search');
    
    postSearchInputs.forEach(function(searchInput) {
      const tagName = searchInput.getAttribute('data-tag');
      const postList = document.querySelector(`.post-list-by-taxonomy[data-tag="${tagName}"]`);
      const postItems = postList ? postList.querySelectorAll('.post-item') : [];
      const noResults = postList ? postList.parentElement.querySelector('.no-results') : null;
      const statsElement = searchInput.parentElement.querySelector('.post-search-stats');
      
      if (statsElement) {
        statsElement.textContent = `å…± ${postItems.length} ç¯‡æ–‡ç« `;
      }
      
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        let visibleCount = 0;
        
        postItems.forEach(function(item) {
          const title = item.getAttribute('data-title');
          const date = item.getAttribute('data-date');
          const isVisible = title.includes(searchTerm) || date.includes(searchTerm);
          
          if (isVisible) {
            item.classList.remove('hidden');
            visibleCount++;
          } else {
            item.classList.add('hidden');
          }
        });
        
        // æ˜¾ç¤º/éšè—æ— ç»“æœæç¤º
        if (noResults) {
          if (searchTerm !== '' && visibleCount === 0) {
            noResults.style.display = 'block';
            postList.style.display = 'none';
          } else {
            noResults.style.display = 'none';
            postList.style.display = 'block';
          }
        }
        
        // æ›´æ–°ç»Ÿè®¡
        if (statsElement) {
          if (searchTerm === '') {
            statsElement.textContent = `å…± ${postItems.length} ç¯‡æ–‡ç« `;
          } else {
            statsElement.textContent = `æ‰¾åˆ° ${visibleCount} / ${postItems.length} ç¯‡æ–‡ç« `;
          }
        }
      });
    });
    
    // é«˜äº®æœç´¢ç»“æœ
    function highlightSearchTerm(element, searchTerm) {
      if (!searchTerm) return;
      
      const walker = document.createTreeWalker(
        element,
        NodeFilter.SHOW_TEXT,
        null,
        false
      );
      
      const textNodes = [];
      let node;
      
      while (node = walker.nextNode()) {
        textNodes.push(node);
      }
      
      textNodes.forEach(function(textNode) {
        const parent = textNode.parentNode;
        if (parent.tagName === 'SCRIPT' || parent.tagName === 'STYLE') return;
        
        const text = textNode.textContent;
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        
        if (regex.test(text)) {
          const highlightedHTML = text.replace(regex, '<mark class="search-highlight">$1</mark>');
          const wrapper = document.createElement('span');
          wrapper.innerHTML = highlightedHTML;
          parent.replaceChild(wrapper, textNode);
        }
      });
    }
    
    // æ¸…é™¤é«˜äº®
    function clearHighlight() {
      const highlights = document.querySelectorAll('.search-highlight');
      highlights.forEach(function(highlight) {
        const parent = highlight.parentNode;
        parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
        parent.normalize();
      });
    }
    
    // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
    document.addEventListener('keydown', function(e) {
      // Ctrl+F æˆ– Cmd+F èšç„¦åˆ°ä¸»æœç´¢æ¡†
      if ((e.ctrlKey || e.metaKey) && e.key === 'f' && tagSearchInput) {
        e.preventDefault();
        tagSearchInput.focus();
        tagSearchInput.select();
      }
      
      // Esc é”®æ¸…ç©ºæœç´¢
      if (e.key === 'Escape') {
        if (tagSearchInput && document.activeElement === tagSearchInput) {
          tagSearchInput.value = '';
          tagSearchInput.dispatchEvent(new Event('input'));
        }
        
        postSearchInputs.forEach(function(input) {
          if (document.activeElement === input) {
            input.value = '';
            input.dispatchEvent(new Event('input'));
          }
        });
      }
    });
  });
</script>

<style>
  /* æœç´¢é«˜äº®æ ·å¼ */
  .search-highlight {
    background-color: yellow;
    color: black;
    padding: 1px 2px;
    border-radius: 2px;
    font-weight: bold;
  }
  
  /* æš—è‰²ä¸»é¢˜ä¸‹çš„é«˜äº® */
  @media (prefers-color-scheme: dark) {
    .search-highlight {
      background-color: #ffeb3b;
      color: #333;
    }
  }
</style>
